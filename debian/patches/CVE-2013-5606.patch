Index: nss-3.12.8/mozilla/security/nss/lib/certhigh/certvfy.c
===================================================================
--- nss-3.12.8.orig/mozilla/security/nss/lib/certhigh/certvfy.c	2010-04-30 09:47:48.000000000 +0200
+++ nss-3.12.8/mozilla/security/nss/lib/certhigh/certvfy.c	2014-03-27 16:29:03.157390098 +0100
@@ -1421,7 +1421,7 @@ CERT_VerifyCert(CERTCertDBHandle *handle
 	    /* is the cert directly trusted or not trusted ? */
 	    if ( flags & CERTDB_VALID_PEER ) {/*the trust record is valid*/
 		if ( flags & CERTDB_TRUSTED ) {	/* trust this cert */
-		    goto winner;
+		    goto done;
 		} else { /* don't trust this cert */
 		    PORT_SetError(SEC_ERROR_UNTRUSTED_CERT);
 		    LOG_ERROR_OR_EXIT(log,cert,0,flags);
@@ -1440,7 +1440,7 @@ CERT_VerifyCert(CERTCertDBHandle *handle
 	    /* is the cert directly trusted or not trusted ? */
 	    if ( ( flags & ( CERTDB_VALID_PEER | CERTDB_TRUSTED ) ) ==
 		( CERTDB_VALID_PEER | CERTDB_TRUSTED ) ) {
-		goto winner;
+		goto done;
 	    }
 	    break;
 	  case certUsageObjectSigner:
@@ -1449,7 +1449,7 @@ CERT_VerifyCert(CERTCertDBHandle *handle
 	    /* is the cert directly trusted or not trusted ? */
 	    if ( flags & CERTDB_VALID_PEER ) {/*the trust record is valid*/
 		if ( flags & CERTDB_TRUSTED ) {	/* trust this cert */
-		    goto winner;
+		    goto done;
 		} else { /* don't trust this cert */
 		    PORT_SetError(SEC_ERROR_UNTRUSTED_CERT);
 		    LOG_ERROR_OR_EXIT(log,cert,0,flags);
@@ -1462,19 +1462,19 @@ CERT_VerifyCert(CERTCertDBHandle *handle
 	    /* is the cert directly trusted or not trusted ? */
 	    if ( ( flags & ( CERTDB_VALID_CA | CERTDB_TRUSTED_CA ) ) ==
 		( CERTDB_VALID_CA | CERTDB_TRUSTED_CA ) ) {
-		goto winner;
+		goto done;
 	    }
 	    flags = cert->trust->emailFlags;
 	    /* is the cert directly trusted or not trusted ? */
 	    if ( ( flags & ( CERTDB_VALID_CA | CERTDB_TRUSTED_CA ) ) ==
 		( CERTDB_VALID_CA | CERTDB_TRUSTED_CA ) ) {
-		goto winner;
+		goto done;
 	    }
 	    flags = cert->trust->objectSigningFlags;
 	    /* is the cert directly trusted or not trusted ? */
 	    if ( ( flags & ( CERTDB_VALID_CA | CERTDB_TRUSTED_CA ) ) ==
 		( CERTDB_VALID_CA | CERTDB_TRUSTED_CA ) ) {
-		goto winner;
+		goto done;
 	    }
 	    break;
 	  case certUsageAnyCA:
@@ -1511,7 +1511,10 @@ CERT_VerifyCert(CERTCertDBHandle *handle
 	}
     }
 
-winner:
+done:
+    if (log && log->head) {
+	return(SECFailure);
+    }
     return(SECSuccess);
 
 loser:
